<h2>AI Rename Layers</h2>
<p id="status">Initializing...</p>
<p id="layerCount"></p>
<p id="progress"></p>
<p id="tokenInfo"></p>
<label for="temperature">Temperature:</label>
<input type="number" id="temperature" min="0" max="2" step="0.01" value="0.85">
<p id="error" style="color: red;"></p>
<button id="start" disabled>Start Renaming</button>
<button id="cancel">Cancel</button>
<script>
let selectedLayers = 0;
let totalLayers = 0;

window.onmessage = (event) => {
  const message = event.data.pluginMessage;
  if (message.type === 'error') {
    document.getElementById('error').textContent = `Error: ${message.message}`;
    document.getElementById('start').disabled = false;
    document.getElementById('status').textContent = 'An error occurred';
  } else if (message.type === 'tokenInfo') {
    document.getElementById('tokenInfo').textContent = `Input tokens: ${message.inputTokens}, Output tokens: ${message.outputTokens}, Estimated cost: $${message.estimatedCost}`;
  } else if (message.type === 'selectionUpdate') {
    selectedLayers = message.selectedCount;
    totalLayers = message.totalCount;
    updateUI();
  } else if (message.type === 'progress') {
    document.getElementById('progress').textContent = `Progress: ${message.current}/${message.total}`;
  } else if (message.type === 'complete') {
    document.getElementById('status').textContent = 'Renaming complete!';
    document.getElementById('progress').textContent = '';
    document.getElementById('start').disabled = false;
    document.getElementById('error').textContent = '';
  } else if (message.type === 'error') {
    document.getElementById('error').textContent = `Error: ${message.message}`;
    document.getElementById('start').disabled = false;
  } else if (message.type === 'tokenInfo') {
    document.getElementById('tokenInfo').textContent = `Input tokens: ${message.inputTokens}, Output tokens: ${message.outputTokens}, Estimated cost: $${message.estimatedCost}`;
  }
};

function updateUI() {
  document.getElementById('layerCount').textContent = `Selected layers: ${selectedLayers} (Total including sublayers: ${totalLayers})`;
  document.getElementById('start').disabled = selectedLayers === 0;
  document.getElementById('status').textContent = selectedLayers === 0 ? 'No layers selected.' : 'Ready to rename layers.';
  document.getElementById('progress').textContent = '';
  document.getElementById('error').textContent = '';
  document.getElementById('tokenInfo').textContent = '';
}

document.getElementById('start').onclick = () => {
  const temperature = parseFloat(document.getElementById('temperature').value);
  parent.postMessage({ pluginMessage: { type: 'start-renaming', temperature } }, '*');
  document.getElementById('status').textContent = 'Renaming layers...';
  document.getElementById('start').disabled = true;
  document.getElementById('error').textContent = '';
};

document.getElementById('cancel').onclick = () => {
  parent.postMessage({ pluginMessage: { type: 'cancel' } }, '*');
};

// Request initial selection info
parent.postMessage({ pluginMessage: { type: 'requestSelection' } }, '*');
</script>